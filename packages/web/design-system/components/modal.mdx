import { Meta, ArgTypes, Canvas, Story } from '@storybook/blocks'
import { Modal, ModalHeader, ModalTitle, ModalDescription, ModalBody, ModalFooter, ConfirmModal } from './modal'
import * as ModalStories from './modal.stories'

<Meta of={ModalStories} />

# Modal

Modals are dialog overlays that require user interaction. They're used for critical information, confirmations, or
complex interactions that benefit from focused attention.

<Canvas of={ModalStories.Default} />

## Anatomy

Modals are composed of several sub-components:

- **Modal**: The main container and overlay
- **ModalHeader**: Contains title and description
- **ModalTitle**: The main heading
- **ModalDescription**: Supporting text
- **ModalBody**: Main content area
- **ModalFooter**: Actions and buttons

## Props

### Modal

<ArgTypes of={Modal} />

## Basic Usage

```tsx
import { Modal, ModalHeader, ModalTitle, ModalDescription, ModalBody, ModalFooter } from '@/components/ui/modal'

function Example() {
  const [open, setOpen] = useState(false)

  return (
    <>
      <Button onClick={() => setOpen(true)}>Open Modal</Button>
      <Modal open={open} onClose={() => setOpen(false)}>
        <ModalHeader>
          <ModalTitle>Modal Title</ModalTitle>
          <ModalDescription>Modal description goes here</ModalDescription>
        </ModalHeader>
        <ModalBody>
          <p>Modal content goes here</p>
        </ModalBody>
        <ModalFooter>
          <Button variant='secondary' onClick={() => setOpen(false)}>
            Cancel
          </Button>
          <Button onClick={() => setOpen(false)}>Save</Button>
        </ModalFooter>
      </Modal>
    </>
  )
}
```

## Sizes

Modals come in various sizes to accommodate different content needs.

<Canvas of={ModalStories.Sizes} />

```tsx
<Modal size="sm">...</Modal>  // 384px max-width
<Modal size="md">...</Modal>  // 448px max-width (default)
<Modal size="lg">...</Modal>  // 512px max-width
<Modal size="xl">...</Modal>  // 576px max-width
<Modal size="full">...</Modal> // 95vw width, 95vh height
```

## Positions

Control where the modal appears on screen.

<Canvas of={ModalStories.Positions} />

```tsx
<Modal position="center">...</Modal> // Centered (default)
<Modal position="top">...</Modal>    // Top of viewport
<Modal position="bottom">...</Modal> // Bottom of viewport
```

## Animations

Different animation styles for modal appearance.

<Canvas of={ModalStories.Animations} />

```tsx
<Modal animation="fade">...</Modal>   // Fade in/out
<Modal animation="slide">...</Modal>  // Slide from top/bottom
<Modal animation="scale">...</Modal>  // Scale up/down (default)
<Modal animation="drawer">...</Modal> // Slide from right
```

## Behavior Options

### Close on Overlay Click

Control whether clicking outside closes the modal.

<Canvas of={ModalStories.NoOverlayClick} />

```tsx
<Modal closeOnOverlayClick={false}>
  <ModalBody>
    <p>Clicking outside won't close this modal</p>
  </ModalBody>
</Modal>
```

### Close on Escape

Control whether Escape key closes the modal.

<Canvas of={ModalStories.NoEscapeKey} />

```tsx
<Modal closeOnEscape={false}>
  <ModalBody>
    <p>Pressing Escape won't close this modal</p>
  </ModalBody>
</Modal>
```

### Close Button

Control visibility of the close button.

<Canvas of={ModalStories.NoCloseButton} />

```tsx
<Modal showCloseButton={false}>
  <ModalBody>
    <p>No close button visible</p>
  </ModalBody>
</Modal>
```

### Blur Effect

Control the backdrop blur effect.

<Canvas of={ModalStories.NoBlur} />

```tsx
<Modal blur={false}>
  <ModalBody>
    <p>No blur effect on backdrop</p>
  </ModalBody>
</Modal>
```

## Common Patterns

### Form Modal

<Canvas of={ModalStories.FormModal} />

```tsx
<Modal open={open} onClose={onClose} size='lg'>
  <ModalHeader>
    <ModalTitle>Create New Project</ModalTitle>
    <ModalDescription>Fill in the details below to create a new project</ModalDescription>
  </ModalHeader>
  <ModalBody>
    <form className='space-y-4'>
      <Input label='Project Name' placeholder='My Project' />
      <Textarea label='Description' rows={3} />
      <Select label='Template'>
        <option>Blank</option>
        <option>Blog</option>
        <option>Portfolio</option>
      </Select>
    </form>
  </ModalBody>
  <ModalFooter>
    <Button variant='secondary' onClick={onClose}>
      Cancel
    </Button>
    <Button variant='primary'>Create Project</Button>
  </ModalFooter>
</Modal>
```

### Scrollable Content

<Canvas of={ModalStories.ScrollableContent} />

```tsx
<Modal open={open} onClose={onClose}>
  <ModalHeader>
    <ModalTitle>Terms of Service</ModalTitle>
  </ModalHeader>
  <ModalBody className='max-h-[400px] overflow-y-auto'>{/* Long content that scrolls */}</ModalBody>
  <ModalFooter>
    <Button variant='secondary'>Decline</Button>
    <Button variant='primary'>Accept</Button>
  </ModalFooter>
</Modal>
```

### Confirmation Modal

<Canvas of={ModalStories.ConfirmationModal} />

```tsx
<ConfirmModal
  open={open}
  onClose={() => setOpen(false)}
  onConfirm={handleDelete}
  title='Delete Item'
  description='Are you sure you want to delete this item?'
  confirmText='Delete'
  cancelText='Cancel'
  variant='destructive'
/>
```

### Image Modal

<Canvas of={ModalStories.ImageModal} />

```tsx
<Modal open={open} onClose={onClose} size='xl'>
  <ModalBody className='p-0'>
    <img src='/path/to/image.jpg' alt='Full size preview' className='w-full h-auto' />
  </ModalBody>
</Modal>
```

### Drawer Style

<Canvas of={ModalStories.DrawerExample} />

```tsx
<Modal open={open} onClose={onClose} animation='drawer' size='sm'>
  <ModalHeader>
    <ModalTitle>Settings</ModalTitle>
  </ModalHeader>
  <ModalBody>{/* Settings form */}</ModalBody>
</Modal>
```

## Nested Modals

Support for stacking multiple modals.

<Canvas of={ModalStories.NestedModals} />

```tsx
<Modal open={firstOpen} onClose={() => setFirstOpen(false)}>
  <ModalBody>
    <Button onClick={() => setSecondOpen(true)}>
      Open Second Modal
    </Button>
  </ModalBody>
</Modal>

<Modal open={secondOpen} onClose={() => setSecondOpen(false)}>
  <ModalBody>
    <p>This modal is stacked on top</p>
  </ModalBody>
</Modal>
```

## Usage Guidelines

### When to Use

- **Critical Actions**: Confirmations for destructive actions
- **Forms**: Complex forms that need focused attention
- **Information**: Important information that requires acknowledgment
- **Media**: Image/video previews in larger view
- **Workflows**: Multi-step processes

### When Not to Use

- **Non-critical Info**: Use toast or inline messages instead
- **Frequent Actions**: Use inline editing or dropdowns
- **Navigation**: Use routing for page-level changes
- **Simple Confirmations**: Consider inline confirmation

### Best Practices

1. **Clear Purpose**: Each modal should have one clear purpose
2. **Escape Hatch**: Always provide a way to close the modal
3. **Focus Management**: Auto-focus important elements
4. **Loading States**: Show loading states for async actions
5. **Error Handling**: Display errors clearly within the modal

### Accessibility

- Focus is trapped within the modal
- Escape key closes modal (unless disabled)
- Screen readers announce modal content
- Proper ARIA attributes for dialog role
- Focus returns to trigger element on close

## Advanced Examples

### Multi-Step Modal

```tsx
function MultiStepModal() {
  const [step, setStep] = useState(1)
  const totalSteps = 3

  return (
    <Modal open={open} onClose={onClose}>
      <ModalHeader>
        <ModalTitle>
          Step {step} of {totalSteps}
        </ModalTitle>
        <Progress value={(step / totalSteps) * 100} />
      </ModalHeader>
      <ModalBody>
        {step === 1 && <StepOne />}
        {step === 2 && <StepTwo />}
        {step === 3 && <StepThree />}
      </ModalBody>
      <ModalFooter>
        <Button variant='secondary' onClick={() => setStep((s) => s - 1)} disabled={step === 1}>
          Previous
        </Button>
        <Button onClick={() => setStep((s) => s + 1)} disabled={step === totalSteps}>
          Next
        </Button>
      </ModalFooter>
    </Modal>
  )
}
```

### Async Form Modal

```tsx
function AsyncFormModal() {
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)

  const handleSubmit = async (data) => {
    setLoading(true)
    setError(null)

    try {
      await saveData(data)
      onClose()
    } catch (err) {
      setError(err.message)
    } finally {
      setLoading(false)
    }
  }

  return (
    <Modal open={open} onClose={onClose}>
      <ModalHeader>
        <ModalTitle>Save Changes</ModalTitle>
      </ModalHeader>
      <ModalBody>
        {error && <Alert variant='error'>{error}</Alert>}
        <form onSubmit={handleSubmit}>{/* Form fields */}</form>
      </ModalBody>
      <ModalFooter>
        <Button variant='secondary' onClick={onClose} disabled={loading}>
          Cancel
        </Button>
        <Button type='submit' loading={loading}>
          Save
        </Button>
      </ModalFooter>
    </Modal>
  )
}
```

### Command Palette Modal

```tsx
<Modal open={open} onClose={onClose} size='lg' position='top'>
  <ModalBody className='p-0'>
    <Command>
      <CommandInput placeholder='Type a command...' />
      <CommandList>
        <CommandGroup heading='Suggestions'>
          <CommandItem>New Note</CommandItem>
          <CommandItem>Search</CommandItem>
          <CommandItem>Settings</CommandItem>
        </CommandGroup>
      </CommandList>
    </Command>
  </ModalBody>
</Modal>
```

## Performance

### Lazy Loading

```tsx
const ModalContent = lazy(() => import('./ModalContent'))

<Modal open={open} onClose={onClose}>
  <Suspense fallback={<Spinner />}>
    <ModalContent />
  </Suspense>
</Modal>
```

### Portal Rendering

Modals render in a portal to avoid z-index issues:

```tsx
createPortal(<Modal>{children}</Modal>, document.body)
```

## Related Components

- [Dialog](/?path=/docs/components-dialog--docs) - Similar but simpler
- [Drawer](/?path=/docs/components-drawer--docs) - Side panel variant
- [Popover](/?path=/docs/components-popover--docs) - Non-blocking overlay
- [Toast](/?path=/docs/components-toast--docs) - Temporary notifications
- [Alert](/?path=/docs/components-alert--docs) - Inline messages
